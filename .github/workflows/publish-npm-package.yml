env:
  NODE_VERSION: 19
jobs:
  publish-npm-package:
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.ref }}
    - continue-on-error: true
      uses: ./.github/actions/cleanup-runner
    - continue-on-error: true
      name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
    - continue-on-error: true
      name: Download all build artifacts
      uses: actions/download-artifact@v4
      with:
        github-token: ${{ secrets.gh-pat }}
        name: ${{ inputs.artifact-id }}
        path: ${{ github.workspace }}/npm-package
        run-id: ${{ inputs.run-id }}
    - continue-on-error: true
      name: Validate NPM package
      run: "echo \"::group::NPM package contents\"\nif [ ! -f ${{ github.workspace\
        \ }}/npm-package/package.json ]; then\n  echo \"::error::NPM package not found.\
        \ Exiting...\"\n  exit 1\nelse\n  echo \"::notice::NPM package found. Proceeding...\"\
        \n  cat ${{ github.workspace }}/npm-package/package.json\nfi\n"
    - continue-on-error: true
      env:
        NPM_AUTH_TOKEN: ${{ secrets.npm-token }}
        NPM_PACKAGE_VERSION_TAG: ${{ inputs.npm-package-version-tag }}
      if: success()
      name: Publish to NPM registry
      run: 'echo "//registry.npmjs.org/:_authToken=${NPM_AUTH_TOKEN}" > ~/.npmrc

        npm publish --access public --tag ${NPM_PACKAGE_VERSION_TAG}

        '
      working-directory: ${{ github.workspace }}/npm-package
name: Publish NPM Package
on:
  repository_dispatch:
    types: trigger-ga___publish-npm-package.yml
