jobs:
  build_image:
    name: Build Docker Base Image
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Checkout core
      uses: actions/checkout@v4
    - continue-on-error: true
      name: Set Common Vars
      run: 'PLATFORMS=''linux/amd64''

        [[ "${{ github.event.inputs.multi_arch }}" == ''true'' ]] && PLATFORMS=''linux/amd64,linux/arm64''


        echo "PLATFORMS=${PLATFORMS}" >> $GITHUB_ENV

        '
    - continue-on-error: true
      if: github.event.inputs.multi_arch == 'true'
      name: Set up QEMU
      uses: docker/setup-qemu-action@v3.0.0
      with:
        platforms: amd64,arm64
    - continue-on-error: true
      id: docker-setup-buildx
      if: github.event.inputs.multi_arch == 'true'
      name: Docker Setup Buildx
      uses: docker/setup-buildx-action@v3.0.0
      with:
        driver-opts: 'image=moby/buildkit:v0.12.2

          '
        platforms: ${{ env.PLATFORMS }}
    - continue-on-error: true
      name: Docker Hub login
      uses: docker/login-action@v3.0.0
      with:
        password: ${{ secrets.DOCKER_TOKEN }}
        username: ${{ secrets.DOCKER_USERNAME }}
    - continue-on-error: true
      name: Build and push
      uses: docker/build-push-action@v5.0.0
      with:
        context: ./docker/${{ github.event.inputs.context }}
        platforms: ${{ env.PLATFORMS }}
        push: false
        tags: ${{ github.event.inputs.tags }}
name: Build Base Image
on:
  repository_dispatch:
    types: trigger-ga___build-docker-context.yml
